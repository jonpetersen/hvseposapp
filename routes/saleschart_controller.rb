class SaleschartController < Sinatra::Base
  #register Sinatra::Twitter::Bootstrap::Assets
  
  get '/' do
    @sales_counts = Allsale.where("type = ? AND MONTH(created_at) = ?","P",Time.now.month).group(:date).count    
    @transaction_counts = Allsale.where("type = ? AND MONTH(created_at) = ?","P",Time.now.month).group(:date).select(:transno).distinct.count
    @sales_values = Allsale.where("type = ? AND MONTH(created_at) = ?","P",Time.now.month).group(:date).sum(:totalprice)
    @salesvat_values = Allsale.where("type = ? AND MONTH(created_at) = ?","P",Time.now.month).group(:date).sum(:vatamount)
            
    #@sales_counts[Date.parse("2016-05-02")] = 0
    #@sales_values[Date.parse("2016-05-02")] = 0
    #@salesvat_values[Date.parse("2016-05-02")] = 0
    
    @sales_values_archive = Archivesale.where("type = ?","P").group(:date).sum(:totalprice)
    @salesvat_values_archive = Archivesale.where("type = ?","P").group(:date).sum(:vatamount)
    
    previous_sales_values = {Date.parse("Sun, 1 Feb 2015") => 	502.42,Date.parse("Mon, 2 Feb 2015") => 	560.41,Date.parse("Tue, 3 Feb 2015") => 	529.62,Date.parse("Wed, 4 Feb 2015") => 	666.41,Date.parse("Thu, 5 Feb 2015") => 	773.71,Date.parse("Fri, 6 Feb 2015") => 	610.28,Date.parse("Sat, 7 Feb 2015") => 	871.06,Date.parse("Sun, 8 Feb 2015") => 	540.73,Date.parse("Mon, 9 Feb 2015") => 	592.47,Date.parse("Tue, 10 Feb 2015") => 	546.52,Date.parse("Wed, 11 Feb 2015") => 	674.05,Date.parse("Thu, 12 Feb 2015") => 	687.15,Date.parse("Fri, 13 Feb 2015") => 	671.52,Date.parse("Sat, 14 Feb 2015") => 	663.25,Date.parse("Sun, 15 Feb 2015") => 	351.99,Date.parse("Mon, 16 Feb 2015") => 	571.55,Date.parse("Tue, 17 Feb 2015") => 	816.48,Date.parse("Wed, 18 Feb 2015") => 	546.91,Date.parse("Thu, 19 Feb 2015") => 	651,Date.parse("Fri, 20 Feb 2015") => 	693.54,Date.parse("Sat, 21 Feb 2015") => 	874.89,Date.parse("Sun, 22 Feb 2015") => 	581.27,Date.parse("Mon, 23 Feb 2015") => 	473.57,Date.parse("Tue, 24 Feb 2015") => 	705.82,Date.parse("Wed, 25 Feb 2015") => 	668.87,Date.parse("Thu, 26 Feb 2015") => 	600.13,Date.parse("Fri, 27 Feb 2015") => 	637.31,Date.parse("Sat, 28 Feb 2015") => 	706.63,Date.parse("Sun, 1 Mar 2015") => 	634.33,Date.parse("Mon, 2 Mar 2015") => 	578.51,Date.parse("Tue, 3 Mar 2015") => 	613.7,Date.parse("Wed, 4 Mar 2015") => 	723.52,Date.parse("Thu, 5 Mar 2015") => 	655.52,Date.parse("Fri, 6 Mar 2015") => 	1000.77,Date.parse("Sat, 7 Mar 2015") => 	848.72,Date.parse("Sun, 8 Mar 2015") => 	570.78,Date.parse("Mon, 9 Mar 2015") => 	608.65,Date.parse("Tue, 10 Mar 2015") => 	696.35,Date.parse("Wed, 11 Mar 2015") => 	647.09,Date.parse("Thu, 12 Mar 2015") => 	755.08,Date.parse("Fri, 13 Mar 2015") => 	683.05,Date.parse("Sat, 14 Mar 2015") => 	925.98,Date.parse("Sun, 15 Mar 2015") => 	605.64,Date.parse("Mon, 16 Mar 2015") => 	654.19,Date.parse("Tue, 17 Mar 2015") => 	756.42,Date.parse("Wed, 18 Mar 2015") => 	665.5,Date.parse("Thu, 19 Mar 2015") => 	717.37,Date.parse("Fri, 20 Mar 2015") => 	712.99,Date.parse("Sat, 21 Mar 2015") => 	868.19,Date.parse("Sun, 22 Mar 2015") => 	645.86,Date.parse("Mon, 23 Mar 2015") => 	698.18,Date.parse("Tue, 24 Mar 2015") => 	670.9,Date.parse("Wed, 25 Mar 2015") => 	716.22,Date.parse("Thu, 26 Mar 2015") => 	599.64,Date.parse("Fri, 27 Mar 2015") => 	1130.27,Date.parse("Sat, 28 Mar 2015") => 	923.13,Date.parse("Sun, 29 Mar 2015") => 	485.87,Date.parse("Mon, 30 Mar 2015") => 	717.75,Date.parse("Tue, 31 Mar 2015") => 	699,Date.parse("Wed, 1 Apr 2015") => 	781.38,Date.parse("Thu, 2 Apr 2015") => 	831.96,Date.parse("Fri, 3 Apr 2015") => 	554.2,Date.parse("Sat, 4 Apr 2015") => 	976.94,Date.parse("Sun, 5 Apr 2015") => 	0,Date.parse("Mon, 6 Apr 2015") => 	460.94,Date.parse("Tue, 7 Apr 2015") => 	637.56,Date.parse("Wed, 8 Apr 2015") => 	680.63,Date.parse("Thu, 9 Apr 2015") => 	759.51,Date.parse("Fri, 10 Apr 2015") => 	897.55,Date.parse("Sat, 11 Apr 2015") => 	700.2,Date.parse("Sun, 12 Apr 2015") => 	578.36,Date.parse("Mon, 13 Apr 2015") => 	801.11,Date.parse("Tue, 14 Apr 2015") => 	913.5,Date.parse("Wed, 15 Apr 2015") => 	737.11,Date.parse("Thu, 16 Apr 2015") => 	753.81,Date.parse("Fri, 17 Apr 2015") => 	1073.27,Date.parse("Sat, 18 Apr 2015") => 	1315.6,Date.parse("Sun, 19 Apr 2015") => 	712.47,Date.parse("Mon, 20 Apr 2015") => 	779,Date.parse("Tue, 21 Apr 2015") => 	788.68,Date.parse("Wed, 22 Apr 2015") => 	746.26,Date.parse("Thu, 23 Apr 2015") => 	930.31,Date.parse("Fri, 24 Apr 2015") => 	1257.61,Date.parse("Sat, 25 Apr 2015") => 	790.68,Date.parse("Sun, 26 Apr 2015") => 	539.41,Date.parse("Mon, 27 Apr 2015") => 	786.89,Date.parse("Tue, 28 Apr 2015") => 	800.44,Date.parse("Wed, 29 Apr 2015") => 	674.68,Date.parse("Thu, 30 Apr 2015") => 	830.62,Date.parse("Fri, 1 May 2015") => 	869.89,Date.parse("Sat, 2 May 2015") => 	1107.94,Date.parse("Sun, 3 May 2015") => 	907.35,Date.parse("Mon, 4 May 2015") => 	477.75,Date.parse("Tue, 5 May 2015") => 	780.53,Date.parse("Wed, 6 May 2015") => 	653.55,Date.parse("Thu, 7 May 2015") => 	1017.56,Date.parse("Fri, 8 May 2015") => 	1039.85,Date.parse("Sat, 9 May 2015") => 	930.22,Date.parse("Sun, 10 May 2015") => 	648.48,Date.parse("Mon, 11 May 2015") => 	851.98,Date.parse("Tue, 12 May 2015") => 	830.06,Date.parse("Wed, 13 May 2015") => 	796.59,Date.parse("Thu, 14 May 2015") => 	572.91,Date.parse("Fri, 15 May 2015") => 	1030.51,Date.parse("Sat, 16 May 2015") => 	1144.53,Date.parse("Sun, 17 May 2015") => 	802.02,Date.parse("Mon, 18 May 2015") => 	604.06,Date.parse("Tue, 19 May 2015") => 	636.42,Date.parse("Wed, 20 May 2015") => 	800.38,Date.parse("Thu, 21 May 2015") => 	746.24,Date.parse("Fri, 22 May 2015") => 	1128.66,Date.parse("Sat, 23 May 2015") => 	1115.64,Date.parse("Sun, 24 May 2015") => 	831.57,Date.parse("Mon, 25 May 2015") => 	307.5,Date.parse("Tue, 26 May 2015") => 	955.56,Date.parse("Wed, 27 May 2015") => 	928.15,Date.parse("Thu, 28 May 2015") => 	866.4,Date.parse("Fri, 29 May 2015") => 	1022.1,Date.parse("Sat, 30 May 2015") => 	1143.36,Date.parse("Sun, 31 May 2015") => 	617,Date.parse("Mon, 1 Jun 2015") => 	704.12,Date.parse("Tue, 2 Jun 2015") => 	670.68,Date.parse("Wed, 3 Jun 2015") => 	734.5,Date.parse("Thu, 4 Jun 2015") => 	800.58,Date.parse("Fri, 5 Jun 2015") => 	1081.79,Date.parse("Sat, 6 Jun 2015") => 	1072.5,Date.parse("Sun, 7 Jun 2015") => 	992.88,Date.parse("Mon, 8 Jun 2015") => 	692.88,Date.parse("Tue, 9 Jun 2015") => 	815.2,Date.parse("Wed, 10 Jun 2015") => 	879.61,Date.parse("Thu, 11 Jun 2015") => 	852.38,Date.parse("Fri, 12 Jun 2015") => 	854.07,Date.parse("Sat, 13 Jun 2015") => 	1544.61,Date.parse("Sun, 14 Jun 2015") => 	887.91,Date.parse("Mon, 15 Jun 2015") => 	631.13,Date.parse("Tue, 16 Jun 2015") => 	781.97,Date.parse("Wed, 17 Jun 2015") => 	830.87,Date.parse("Thu, 18 Jun 2015") => 	1212.23,Date.parse("Fri, 19 Jun 2015") => 	1165.18,Date.parse("Sat, 20 Jun 2015") => 	1020.27,Date.parse("Sun, 21 Jun 2015") => 	753.25,Date.parse("Mon, 22 Jun 2015") => 	700.5,Date.parse("Tue, 23 Jun 2015") => 	752.22,Date.parse("Wed, 24 Jun 2015") => 	930.43,Date.parse("Thu, 25 Jun 2015") => 	764.81,Date.parse("Fri, 26 Jun 2015") => 	1192.75,Date.parse("Sat, 27 Jun 2015") => 	1377.06,Date.parse("Sun, 28 Jun 2015") => 	760.71,Date.parse("Mon, 29 Jun 2015") => 	718.88,Date.parse("Tue, 30 Jun 2015") => 	858.6,Date.parse("Wed, 1 Jul 2015") => 	797.89,Date.parse("Thu, 2 Jul 2015") => 	818.15,Date.parse("Fri, 3 Jul 2015") => 	1168.2,Date.parse("Sat, 4 Jul 2015") => 	1131.13,Date.parse("Sun, 5 Jul 2015") => 	749.72,Date.parse("Mon, 6 Jul 2015") => 	739.32,Date.parse("Tue, 7 Jul 2015") => 	705.44,Date.parse("Wed, 8 Jul 2015") => 	984.45,Date.parse("Thu, 9 Jul 2015") => 	1045.23,Date.parse("Fri, 10 Jul 2015") => 	1390.73,Date.parse("Sat, 11 Jul 2015") => 	1179.93,Date.parse("Sun, 12 Jul 2015") => 	570.07,Date.parse("Mon, 13 Jul 2015") => 	670.96,Date.parse("Tue, 14 Jul 2015") => 	744.35,Date.parse("Wed, 15 Jul 2015") => 	902.12,Date.parse("Thu, 16 Jul 2015") => 	1044.54,Date.parse("Fri, 17 Jul 2015") => 	964.91,Date.parse("Sat, 18 Jul 2015") => 	1308.87,Date.parse("Sun, 19 Jul 2015") => 	825.97,Date.parse("Mon, 20 Jul 2015") => 	710.08,Date.parse("Tue, 21 Jul 2015") => 	986.11,Date.parse("Wed, 22 Jul 2015") => 	795.71,Date.parse("Thu, 23 Jul 2015") => 	893.13,Date.parse("Fri, 24 Jul 2015") => 	992.35,Date.parse("Sat, 25 Jul 2015") => 	1094.6,Date.parse("Sun, 26 Jul 2015") => 	926.48,Date.parse("Mon, 27 Jul 2015") => 	644.08,Date.parse("Tue, 28 Jul 2015") => 	945.21,Date.parse("Wed, 29 Jul 2015") => 	888.07,Date.parse("Thu, 30 Jul 2015") => 	542.26,Date.parse("Fri, 31 Jul 2015") => 	1224,Date.parse("Sat, 1 Aug 2015") => 	905.1,Date.parse("Sun, 2 Aug 2015") => 	623.54,Date.parse("Mon, 3 Aug 2015") => 	814.4,Date.parse("Tue, 4 Aug 2015") => 	719.31,Date.parse("Wed, 5 Aug 2015") => 	666.45,Date.parse("Thu, 6 Aug 2015") => 	949.26,Date.parse("Fri, 7 Aug 2015") => 	1125.41,Date.parse("Sat, 8 Aug 2015") => 	1050.85,Date.parse("Sun, 9 Aug 2015") => 	740.61,Date.parse("Mon, 10 Aug 2015") => 	622.1,Date.parse("Tue, 11 Aug 2015") => 	770.4,Date.parse("Wed, 12 Aug 2015") => 	736.91,Date.parse("Thu, 13 Aug 2015") => 	857.22,Date.parse("Fri, 14 Aug 2015") => 	911.91,Date.parse("Sat, 15 Aug 2015") => 	824.85,Date.parse("Sun, 16 Aug 2015") => 	842.08,Date.parse("Mon, 17 Aug 2015") => 	814.4,Date.parse("Tue, 18 Aug 2015") => 	625.56,Date.parse("Wed, 19 Aug 2015") => 	713.2,Date.parse("Thu, 20 Aug 2015") => 	807.95,Date.parse("Fri, 21 Aug 2015") => 	946.92,Date.parse("Sat, 22 Aug 2015") => 	965.54,Date.parse("Sun, 23 Aug 2015") => 	556.95,Date.parse("Mon, 24 Aug 2015") => 	660.62,Date.parse("Tue, 25 Aug 2015") => 	655,Date.parse("Wed, 26 Aug 2015") => 	566.45,Date.parse("Thu, 27 Aug 2015") => 	719.21,Date.parse("Fri, 28 Aug 2015") => 	949.8,Date.parse("Sat, 29 Aug 2015") => 	858.59,Date.parse("Sun, 30 Aug 2015") => 	480.71,Date.parse("Mon, 31 Aug 2015") => 	280,Date.parse("Tue, 1 Sep 2015") => 	692.79,Date.parse("Wed, 2 Sep 2015") => 	759.31,Date.parse("Thu, 3 Sep 2015") => 	870.4,Date.parse("Fri, 4 Sep 2015") => 	961.88,Date.parse("Sat, 5 Sep 2015") => 	843.75,Date.parse("Sun, 6 Sep 2015") => 	795.83,Date.parse("Mon, 7 Sep 2015") => 	727.11,Date.parse("Tue, 8 Sep 2015") => 	610.68,Date.parse("Wed, 9 Sep 2015") => 	621.3,Date.parse("Thu, 10 Sep 2015") => 	857.75,Date.parse("Fri, 11 Sep 2015") => 	1054.97,Date.parse("Sat, 12 Sep 2015") => 	861.39,Date.parse("Sun, 13 Sep 2015") => 	663.94,Date.parse("Mon, 14 Sep 2015") => 	638.49,Date.parse("Tue, 15 Sep 2015") => 	639.23,Date.parse("Wed, 16 Sep 2015") => 	642.64,Date.parse("Thu, 17 Sep 2015") => 	787.15,Date.parse("Fri, 18 Sep 2015") => 	960.14,Date.parse("Sat, 19 Sep 2015") => 	919.65,Date.parse("Sun, 20 Sep 2015") => 	637.34,Date.parse("Mon, 21 Sep 2015") => 	635.41,Date.parse("Tue, 22 Sep 2015") => 	707.59,Date.parse("Wed, 23 Sep 2015") => 	733.78,Date.parse("Thu, 24 Sep 2015") => 	769.87,Date.parse("Fri, 25 Sep 2015") => 	884.23,Date.parse("Sat, 26 Sep 2015") => 	806.9,Date.parse("Sun, 27 Sep 2015") => 	551.82,Date.parse("Mon, 28 Sep 2015") => 	706.46,Date.parse("Tue, 29 Sep 2015") => 	789.4,Date.parse("Wed, 30 Sep 2015") => 	703.23,Date.parse("Thu, 1 Oct 2015") => 	708.35,Date.parse("Fri, 2 Oct 2015") => 	905.65,Date.parse("Sat, 3 Oct 2015") => 	875.38,Date.parse("Sun, 4 Oct 2015") => 	815.41,Date.parse("Mon, 5 Oct 2015") => 	535.85,Date.parse("Tue, 6 Oct 2015") => 	642,Date.parse("Wed, 7 Oct 2015") => 	480.42,Date.parse("Thu, 8 Oct 2015") => 	721.99,Date.parse("Fri, 9 Oct 2015") => 	1004.33,Date.parse("Sat, 10 Oct 2015") => 	734.82,Date.parse("Sun, 11 Oct 2015") => 	896.6,Date.parse("Mon, 12 Oct 2015") => 	802.1,Date.parse("Tue, 13 Oct 2015") => 	753.38,Date.parse("Wed, 14 Oct 2015") => 	808.88,Date.parse("Thu, 15 Oct 2015") => 	682.65,Date.parse("Fri, 16 Oct 2015") => 	832.89,Date.parse("Sat, 17 Oct 2015") => 	961.83,Date.parse("Sun, 18 Oct 2015") => 	635.87,Date.parse("Mon, 19 Oct 2015") => 	621.92,Date.parse("Tue, 20 Oct 2015") => 	541.69,Date.parse("Wed, 21 Oct 2015") => 	592.46,Date.parse("Thu, 22 Oct 2015") => 	591.11,Date.parse("Fri, 23 Oct 2015") => 	849.39,Date.parse("Sat, 24 Oct 2015") => 	752.34,Date.parse("Sun, 25 Oct 2015") => 	582.86,Date.parse("Mon, 26 Oct 2015") =>	516.96,Date.parse("Tue, 27 Oct 2015") =>	474.5}
    
    previous_vat_values = {Date.parse("Sun, 1 Feb 2015") => 29.3, Date.parse("Mon, 2 Feb 2015") => 38.63, Date.parse("Tue, 3 Feb 2015") => 30, Date.parse("Wed, 4 Feb 2015") => 58.76, Date.parse("Thu, 5 Feb 2015") => 82.58, Date.parse("Fri, 6 Feb 2015") => 45.53, Date.parse("Sat, 7 Feb 2015") => 45.28, Date.parse("Sun, 8 Feb 2015") => 44.16, Date.parse("Mon, 9 Feb 2015") => 55.53, Date.parse("Tue, 10 Feb 2015") => 39.88, Date.parse("Wed, 11 Feb 2015") => 64.04, Date.parse("Thu, 12 Feb 2015") => 48.06, Date.parse("Fri, 13 Feb 2015") => 53.07, Date.parse("Sat, 14 Feb 2015") => 34.7, Date.parse("Sun, 15 Feb 2015") => 34.33, Date.parse("Mon, 16 Feb 2015") => 46.07, Date.parse("Tue, 17 Feb 2015") => 45.39, Date.parse("Wed, 18 Feb 2015") => 48.21, Date.parse("Thu, 19 Feb 2015") => 46.05, Date.parse("Fri, 20 Feb 2015") => 36.15, Date.parse("Sat, 21 Feb 2015") => 45.38, Date.parse("Sun, 22 Feb 2015") => 32.19, Date.parse("Mon, 23 Feb 2015") => 36.62, Date.parse("Tue, 24 Feb 2015") => 48.78, Date.parse("Wed, 25 Feb 2015") => 40, Date.parse("Thu, 26 Feb 2015") => 43.35, Date.parse("Fri, 27 Feb 2015") => 47.98, Date.parse("Sat, 28 Feb 2015") => 28.66, Date.parse("Sun, 1 Mar 2015") => 34.69, Date.parse("Mon, 2 Mar 2015") => 45.33, Date.parse("Tue, 3 Mar 2015") => 47.22, Date.parse("Wed, 4 Mar 2015") => 68.9, Date.parse("Thu, 5 Mar 2015") => 42.18, Date.parse("Fri, 6 Mar 2015") => 79.3, Date.parse("Sat, 7 Mar 2015") => 56.86, Date.parse("Sun, 8 Mar 2015") => 35.67, Date.parse("Mon, 9 Mar 2015") => 33.99, Date.parse("Tue, 10 Mar 2015") => 46.66, Date.parse("Wed, 11 Mar 2015") => 39.88, Date.parse("Thu, 12 Mar 2015") => 74.41, Date.parse("Fri, 13 Mar 2015") => 56.5, Date.parse("Sat, 14 Mar 2015") => 59.26, Date.parse("Sun, 15 Mar 2015") => 36.6, Date.parse("Mon, 16 Mar 2015") => 54.45, Date.parse("Tue, 17 Mar 2015") => 66.65, Date.parse("Wed, 18 Mar 2015") => 60, Date.parse("Thu, 19 Mar 2015") => 45.94, Date.parse("Fri, 20 Mar 2015") => 40.06, Date.parse("Sat, 21 Mar 2015") => 34.76, Date.parse("Sun, 22 Mar 2015") => 49.73, Date.parse("Mon, 23 Mar 2015") => 68.9, Date.parse("Tue, 24 Mar 2015") => 31.39, Date.parse("Wed, 25 Mar 2015") => 57.7, Date.parse("Thu, 26 Mar 2015") => 50.13, Date.parse("Fri, 27 Mar 2015") => 113.91, Date.parse("Sat, 28 Mar 2015") => 59.21, Date.parse("Sun, 29 Mar 2015") => 37.09, Date.parse("Mon, 30 Mar 2015") => 63.23, Date.parse("Tue, 31 Mar 2015") => 67.93, Date.parse("Wed, 1 Apr 2015") => 62.56, Date.parse("Thu, 2 Apr 2015") => 52.78, Date.parse("Fri, 3 Apr 2015") => 35.42, Date.parse("Sat, 4 Apr 2015") => 58.4, Date.parse("Sun, 5 Apr 2015") => 0, Date.parse("Mon, 6 Apr 2015") => 36.07, Date.parse("Tue, 7 Apr 2015") => 51.74, Date.parse("Wed, 8 Apr 2015") => 52.15, Date.parse("Thu, 9 Apr 2015") => 70.73, Date.parse("Fri, 10 Apr 2015") => 62.35, Date.parse("Sat, 11 Apr 2015") => 44.71, Date.parse("Sun, 12 Apr 2015") => 30.87, Date.parse("Mon, 13 Apr 2015") => 58.91, Date.parse("Tue, 14 Apr 2015") => 87.82, Date.parse("Wed, 15 Apr 2015") => 60, Date.parse("Thu, 16 Apr 2015") => 64.94, Date.parse("Fri, 17 Apr 2015") => 93.97, Date.parse("Sat, 18 Apr 2015") => 70.3, Date.parse("Sun, 19 Apr 2015") => 69.9, Date.parse("Mon, 20 Apr 2015") => 50.85, Date.parse("Tue, 21 Apr 2015") => 37.05, Date.parse("Wed, 22 Apr 2015") => 59.97, Date.parse("Thu, 23 Apr 2015") => 67.45, Date.parse("Fri, 24 Apr 2015") => 97.63, Date.parse("Sat, 25 Apr 2015") => 60.63, Date.parse("Sun, 26 Apr 2015") => 33.92, Date.parse("Mon, 27 Apr 2015") => 66.8, Date.parse("Tue, 28 Apr 2015") => 57.08, Date.parse("Wed, 29 Apr 2015") => 52.96, Date.parse("Thu, 30 Apr 2015") => 71.63, Date.parse("Fri, 1 May 2015") => 67.55, Date.parse("Sat, 2 May 2015") => 80.48, Date.parse("Sun, 3 May 2015") => 73.44, Date.parse("Mon, 4 May 2015") => 24.65, Date.parse("Tue, 5 May 2015") => 37.85, Date.parse("Wed, 6 May 2015") => 46.51, Date.parse("Thu, 7 May 2015") => 92.68, Date.parse("Fri, 8 May 2015") => 100.88, Date.parse("Sat, 9 May 2015") => 78.04, Date.parse("Sun, 10 May 2015") => 42.9, Date.parse("Mon, 11 May 2015") => 66.63, Date.parse("Tue, 12 May 2015") => 69.65, Date.parse("Wed, 13 May 2015") => 78.36, Date.parse("Thu, 14 May 2015") => 46.06, Date.parse("Fri, 15 May 2015") => 92.24, Date.parse("Sat, 16 May 2015") => 78.45, Date.parse("Sun, 17 May 2015") => 51.98, Date.parse("Mon, 18 May 2015") => 36.17, Date.parse("Tue, 19 May 2015") => 36.82, Date.parse("Wed, 20 May 2015") => 70.26, Date.parse("Thu, 21 May 2015") => 63.62, Date.parse("Fri, 22 May 2015") => 102.62, Date.parse("Sat, 23 May 2015") => 74.11, Date.parse("Sun, 24 May 2015") => 57.59, Date.parse("Mon, 25 May 2015") => 18.44, Date.parse("Tue, 26 May 2015") => 79.56, Date.parse("Wed, 27 May 2015") => 78.59, Date.parse("Thu, 28 May 2015") => 64.97, Date.parse("Fri, 29 May 2015") => 80.02, Date.parse("Sat, 30 May 2015") => 80.21, Date.parse("Sun, 31 May 2015") => 36.06, Date.parse("Mon, 1 Jun 2015") => 48.7, Date.parse("Tue, 2 Jun 2015") => 26.53, Date.parse("Wed, 3 Jun 2015") => 64.27, Date.parse("Thu, 4 Jun 2015") => 64.36, Date.parse("Fri, 5 Jun 2015") => 90.3, Date.parse("Sat, 6 Jun 2015") => 69.6, Date.parse("Sun, 7 Jun 2015") => 68.29, Date.parse("Mon, 8 Jun 2015") => 41, Date.parse("Tue, 9 Jun 2015") => 54.83, Date.parse("Wed, 10 Jun 2015") => 62.2, Date.parse("Thu, 11 Jun 2015") => 62.86, Date.parse("Fri, 12 Jun 2015") => 144.32, Date.parse("Sat, 13 Jun 2015") => 92.98, Date.parse("Sun, 14 Jun 2015") => 80.63, Date.parse("Mon, 15 Jun 2015") => 44.4, Date.parse("Tue, 16 Jun 2015") => 58.8, Date.parse("Wed, 17 Jun 2015") => 62.48, Date.parse("Thu, 18 Jun 2015") => 110.69, Date.parse("Fri, 19 Jun 2015") => 91.55, Date.parse("Sat, 20 Jun 2015") => 60.92, Date.parse("Sun, 21 Jun 2015") => 48.56, Date.parse("Mon, 22 Jun 2015") => 42.81, Date.parse("Tue, 23 Jun 2015") => 54.23, Date.parse("Wed, 24 Jun 2015") => 69.97, Date.parse("Thu, 25 Jun 2015") => 57.51, Date.parse("Fri, 26 Jun 2015") => 89.69, Date.parse("Sat, 27 Jun 2015") => 103.55, Date.parse("Sun, 28 Jun 2015") => 57.21, Date.parse("Mon, 29 Jun 2015") => 54.06, Date.parse("Tue, 30 Jun 2015") => 64.57, Date.parse("Wed, 1 Jul 2015") => 60, Date.parse("Thu, 2 Jul 2015") => 61.52, Date.parse("Fri, 3 Jul 2015") => 87.85, Date.parse("Sat, 4 Jul 2015") => 85.06, Date.parse("Sun, 5 Jul 2015") => 56.38, Date.parse("Mon, 6 Jul 2015") => 55.6, Date.parse("Tue, 7 Jul 2015") => 53.05, Date.parse("Wed, 8 Jul 2015") => 74.03, Date.parse("Thu, 9 Jul 2015") => 78.6, Date.parse("Fri, 10 Jul 2015") => 104.58, Date.parse("Sat, 11 Jul 2015") => 88.73, Date.parse("Sun, 12 Jul 2015") => 42.87, Date.parse("Mon, 13 Jul 2015") => 50.47, Date.parse("Tue, 14 Jul 2015") => 55.98, Date.parse("Wed, 15 Jul 2015") => 67.84, Date.parse("Thu, 16 Jul 2015") => 78.55, Date.parse("Fri, 17 Jul 2015") => 72.56, Date.parse("Sat, 18 Jul 2015") => 98.43, Date.parse("Sun, 19 Jul 2015") => 62.11, Date.parse("Mon, 20 Jul 2015") => 53.4, Date.parse("Tue, 21 Jul 2015") => 74.16, Date.parse("Wed, 22 Jul 2015") => 59.84, Date.parse("Thu, 23 Jul 2015") => 67.16, Date.parse("Fri, 24 Jul 2015") => 71.45, Date.parse("Sat, 25 Jul 2015") => 78.81, Date.parse("Sun, 26 Jul 2015") => 66.71, Date.parse("Mon, 27 Jul 2015") => 46.37, Date.parse("Tue, 28 Jul 2015") => 68.05, Date.parse("Wed, 29 Jul 2015") => 63.94, Date.parse("Thu, 30 Jul 2015") => 39.04, Date.parse("Fri, 31 Jul 2015") => 88.11, Date.parse("Sat, 1 Aug 2015") => 64.19, Date.parse("Sun, 2 Aug 2015") => 44.89, Date.parse("Mon, 3 Aug 2015") => 63.24, Date.parse("Tue, 4 Aug 2015") => 51.79, Date.parse("Wed, 5 Aug 2015") => 47.98, Date.parse("Thu, 6 Aug 2015") => 68.35, Date.parse("Fri, 7 Aug 2015") => 81.06, Date.parse("Sat, 8 Aug 2015") => 75.66, Date.parse("Sun, 9 Aug 2015") => 53.32, Date.parse("Mon, 10 Aug 2015") => 44.79, Date.parse("Tue, 11 Aug 2015") => 55.47, Date.parse("Wed, 12 Aug 2015") => 53.06, Date.parse("Thu, 13 Aug 2015") => 61.72, Date.parse("Fri, 14 Aug 2015") => 65.66, Date.parse("Sat, 15 Aug 2015") => 59.39, Date.parse("Sun, 16 Aug 2015") => 78.15, Date.parse("Mon, 17 Aug 2015") => 58.64, Date.parse("Tue, 18 Aug 2015") => 45.04, Date.parse("Wed, 19 Aug 2015") => 51.35, Date.parse("Thu, 20 Aug 2015") => 58.17, Date.parse("Fri, 21 Aug 2015") => 68.18, Date.parse("Sat, 22 Aug 2015") => 69.52, Date.parse("Sun, 23 Aug 2015") => 40.1, Date.parse("Mon, 24 Aug 2015") => 47.56, Date.parse("Tue, 25 Aug 2015") => 47.16, Date.parse("Wed, 26 Aug 2015") => 40.78, Date.parse("Thu, 27 Aug 2015") => 51.78, Date.parse("Fri, 28 Aug 2015") => 68.39, Date.parse("Sat, 29 Aug 2015") => 61.82, Date.parse("Sun, 30 Aug 2015") => 34.61, Date.parse("Mon, 31 Aug 2015") => 20.15, Date.parse("Tue, 1 Sep 2015") => 49.88, Date.parse("Wed, 2 Sep 2015") => 54.67, Date.parse("Thu, 3 Sep 2015") => 62.67, Date.parse("Fri, 4 Sep 2015") => 69.26, Date.parse("Sat, 5 Sep 2015") => 60.75, Date.parse("Sun, 6 Sep 2015") => 57.3, Date.parse("Mon, 7 Sep 2015") => 52.35, Date.parse("Tue, 8 Sep 2015") => 43.97, Date.parse("Wed, 9 Sep 2015") => 44.73, Date.parse("Thu, 10 Sep 2015") => 61.76, Date.parse("Fri, 11 Sep 2015") => 75.96, Date.parse("Sat, 12 Sep 2015") => 62.02, Date.parse("Sun, 13 Sep 2015") => 47.8, Date.parse("Mon, 14 Sep 2015") => 45.97, Date.parse("Tue, 15 Sep 2015") => 46.02, Date.parse("Wed, 16 Sep 2015") => 46.27, Date.parse("Thu, 17 Sep 2015") => 56.67, Date.parse("Fri, 18 Sep 2015") => 69.13, Date.parse("Sat, 19 Sep 2015") => 66.21, Date.parse("Sun, 20 Sep 2015") => 45.89, Date.parse("Mon, 21 Sep 2015") => 45.75, Date.parse("Tue, 22 Sep 2015") => 50.95, Date.parse("Wed, 23 Sep 2015") => 52.83, Date.parse("Thu, 24 Sep 2015") => 55.43, Date.parse("Fri, 25 Sep 2015") => 63.66, Date.parse("Sat, 26 Sep 2015") => 58.1, Date.parse("Sun, 27 Sep 2015") => 39.73, Date.parse("Mon, 28 Sep 2015") => 50.89, Date.parse("Tue, 29 Sep 2015") => 56.84, Date.parse("Wed, 30 Sep 2015") => 50.63, Date.parse("Thu, 1 Oct 2015") => 51, Date.parse("Fri, 2 Oct 2015") => 65.21, Date.parse("Sat, 3 Oct 2015") => 63.03, Date.parse("Sun, 4 Oct 2015") => 58.71, Date.parse("Mon, 5 Oct 2015") => 38.58, Date.parse("Tue, 6 Oct 2015") => 46.22, Date.parse("Wed, 7 Oct 2015") => 34.59, Date.parse("Thu, 8 Oct 2015") => 51.98, Date.parse("Fri, 9 Oct 2015") => 72.31, Date.parse("Sat, 10 Oct 2015") => 52.9, Date.parse("Sun, 11 Oct 2015") => 64.56, Date.parse("Mon, 12 Oct 2015") => 57.76, Date.parse("Tue, 13 Oct 2015") => 54.24, Date.parse("Wed, 14 Oct 2015") => 58.24, Date.parse("Thu, 15 Oct 2015") => 49.15, Date.parse("Fri, 16 Oct 2015") => 59.97, Date.parse("Sat, 17 Oct 2015") => 69.25, Date.parse("Sun, 18 Oct 2015") => 45.78, Date.parse("Mon, 19 Oct 2015") => 44.78, Date.parse("Tue, 20 Oct 2015") => 39, Date.parse("Wed, 21 Oct 2015") => 42.66, Date.parse("Thu, 22 Oct 2015") => 42.56, Date.parse("Fri, 23 Oct 2015") => 61.16, Date.parse("Sat, 24 Oct 2015") => 54.17, Date.parse("Sun, 25 Oct 2015") => 41.97, Date.parse("Mon, 26 Oct 2015") => 37.22, Date.parse("Tue, 27 Oct 2015") => 34.16}
        
    @missing_sales_values = {@sales_values_archive.keys[97] + 1 => 193.68,@sales_values_archive.keys[97] + 2 => 198.19,@sales_values_archive.keys[97] + 3 => 186.54,@sales_values_archive.keys[97] + 4 => 164.89,@sales_values_archive.keys[97] + 5 => 282.38,@sales_values_archive.keys[97] + 6 => 231.92,@sales_values_archive.keys[97] + 7 => 112.84,@sales_values_archive.keys[97] + 8 => 250.99,@sales_values_archive.keys[97] + 9 => 374.36,@sales_values_archive.keys[97] + 10 => 402.48,"Mon 02 May 2016".to_date => 0.0}
    
    missingvatpercent = 0.077
    
    @missing_salesvat_values = {@salesvat_values_archive.keys[97] + 1 => 193.68 * missingvatpercent,@salesvat_values_archive.keys[97] + 2 => 198.19 * missingvatpercent,@salesvat_values_archive.keys[97] + 3 => 186.54 * missingvatpercent,@salesvat_values_archive.keys[97] + 4 => 164.89 * missingvatpercent,@salesvat_values_archive.keys[97] + 5 => 282.38 * missingvatpercent,@salesvat_values_archive.keys[97] + 6 => 231.92 * missingvatpercent,@salesvat_values_archive.keys[97] + 7 => 112.84 * missingvatpercent,@salesvat_values_archive.keys[97] + 8 => 250.99 * missingvatpercent,@salesvat_values_archive.keys[97] + 9 => 374.36 * missingvatpercent,@salesvat_values_archive.keys[97] + 10 => 402.48 * missingvatpercent,"Mon 02 May 16".to_date => 0.0}
    
    @monthly_sales_values = Archivesale.where("type = ? AND created_at > ?","P",Date.parse("1/3/2016")).group_by_month(:created_at).sum(:totalprice)
        
    missing_monthly_sales_values = {Date.parse("1/2/2016") => 11979,Date.parse("1/1/2016") => 17095.99,Date.parse("1/12/2015") => 21291.36,Date.parse("1/11/2015") => 18799.91,Date.parse("1/10/2015") => 22167.76,Date.parse("1/9/2015") => 22834.43,Date.parse("1/8/2015") => 23761.13,Date.parse("1/7/2015") => 28383.76,Date.parse("1/6/2015") => 27034.57,Date.parse("1/5/2015") => 26165.02,Date.parse("1/4/2015") => 23090.68,Date.parse("1/3/2015") => 22209.08,Date.parse("1/2/2015") => 17769.56,Date.parse("1/1/2015") => 16496,Date.parse("1/12/2014") => 21746,Date.parse("1/11/2014") => 15854,Date.parse("1/10/2014") => 21077,Date.parse("1/9/2014") => 17872,Date.parse("1/8/2014") => 18002,Date.parse("1/7/2014") => 18390,Date.parse("1/6/2014") => 17149,Date.parse("1/5/2014") => 13455,Date.parse("1/4/2014") => 13584,Date.parse("1/3/2014") => 12108,Date.parse("1/2/2014") => 9952,Date.parse("1/1/2014") => 9369,Date.parse("1/12/2013") => 14084,Date.parse("1/11/2013") => 11069,Date.parse("1/10/2013") => 10916,Date.parse("1/9/2013") => 10637,Date.parse("1/8/2013") => 12822,Date.parse("1/7/2013") => 13476,Date.parse("1/6/2013") => 13504,Date.parse("1/5/2013") => 12762,Date.parse("1/4/2013") => 11514,Date.parse("1/3/2013") => 10799,Date.parse("1/2/2013") => 9858}
    
    @monthly_sales_values = @monthly_sales_values.merge(missing_monthly_sales_values)
    
    @monthly_sales_values = @monthly_sales_values.sort_by{|k,v| k}
    
    @monthly_sales_values_for_chart = []
    @monthly_sales_values.each do |a|	    
	  #@monthly_sales_values_for_chart << [a[0].strftime("%b %y"),a[1]]
	  @monthly_sales_values_for_chart << [a[0].to_date,a[1]]    
	end
    
        
    #merge order changed because April 30th data in archive and allsales
    @all_sales_values = @sales_values.merge(@sales_values_archive).merge(@missing_sales_values).merge(previous_sales_values) 
    @all_salesvat_values = @salesvat_values_archive.merge(@salesvat_values).merge(@missing_salesvat_values).merge(previous_vat_values)

    @all_sales_values[Date.parse("2015-12-25")] = 0
    @all_sales_values[Date.parse("2015-12-26")] = 0
    @all_sales_values[Date.parse("2015-12-27")] = 0
    @all_sales_values[Date.parse("2015-12-28")] = 0
    @all_sales_values[Date.parse("2016-01-01")] = 0
    @all_sales_values[Date.parse("2016-05-02")] = 0
    
    @all_salesvat_values[Date.parse("2015-12-25")] = 0
    @all_salesvat_values[Date.parse("2015-12-26")] = 0
    @all_salesvat_values[Date.parse("2015-12-27")] = 0
    @all_salesvat_values[Date.parse("2015-12-28")] = 0
    @all_salesvat_values[Date.parse("2016-01-01")] = 0
    @all_salesvat_values[Date.parse("2016-05-02")] = 0

    @vatpercent_hash = {}

    @all_sales_values.each do |h|
	  salesvat = @all_salesvat_values.detect {|k,v| k==h[0] }[1]
	  if salesvat != 0
	    @vatpercent_hash[h[0]] = ( salesvat.to_f / h[1].to_f ) * 100
	  else
	    @vatpercent_hash[h[0]] = 0
	  end   
	end
    
    #fix fudge for 30 April 2016 - shouldn't be needed once May has been archived
    @vatpercent_hash[Date.parse("2016-04-30")] = 6.89
    
    #sort into date order for charting
    @all_sales_values = @all_sales_values.sort_by{|k,v| k}
    
    @all_sales_values_for_chart = []
    @all_sales_values.each do |a|	    
	  #@all_sales_values_for_chart << [a[0].strftime("%a %d %b %Y"),a[1].to_f]
	  @all_sales_values_for_chart << [a[0],a[1].to_f]    
	end    
    
    @vatpercent_hash = @vatpercent_hash.sort_by{|k,v| k}
    
    haml :saleschart    
       
  end

end